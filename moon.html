<!DOCTYPE html>
<html lang='en'>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'    />
<meta name='viewport' content='width=device-width, initial-scale=1.0' />

<title>moon phase</title>

<style>
    body { font-family: sans-serif; }
</style>

<script src='/opt/kwynn/js/utils.js'></script>

<script>

class moon {
    
    constructor(at) {
        const f     = this.fractionFromNew0V = moon.fractionFromNew0(at);
        this.phase  = moon.calcPhase(f);
        this.pillum = moon.calcIllum(f);
    }
    
    static calcIllum(f) {
        
    }

    static fractionFromNew0(nowmsin) {
        let nowms;
        if (nowmsin) nowms = nowmsin;
        else         nowms = time();
        const julianUNIXEpoch = 2440587.5;
        const msinday = 86400000;
        const jd = (nowms / msinday) + julianUNIXEpoch;
        const moonth = moon.getMoonth();
        const newMoon_2000_0106_Gregorian = 2451550.1;
        const edays = jd - newMoon_2000_0106_Gregorian;
        const moonths = edays / moonth;
        const floor = Math.floor(moonths);
        const  perToNew = moonths - floor;
        return perToNew;
    }
    
    static getMoonth() { return 29.5305888531; }
    
    static calcPhase(p) {
        let ph = '';
        const fulld = 1 / moon.getMoonth();
        if   (p <= 0.5) ph += 'waxing ';
        else            ph += 'waning ';
        
        if (Math.abs(p - fulld) <= 1    ) ph += '(full)';
        else if (p <= 0.25 || p >= 0.75 ) ph += 'crescent';
        else                              ph += 'gibbous';
        
        return ph;
    }
}
window.addEventListener('DOMContentLoaded', () => {   
    new displayMoon(); 
});

class displayMoon {
    
    config() {
        this.e10 = byid('per10');
        this.dinterval = 150;
        this.decright = 8;
    }
    
    constructor() {
        this.config();
        this.onInt();
        this.setInt();
    }

    onInt() {
        const p = moon.fractionFromNew0(time());
        const pd = p.toFixed(this.decright);
        this.e10.innerHTML = pd;
    }

    setInt() {
        const self = this;
        setInterval(() => { self.onInt(); }, this.dinterval);       
    }
}

</script>
    
</head>
<body>
    <div>v12-0003</div>
    <div id='per10'></div>
    <table>
        <thead>
            <tr><th>at</th><th>f</th></tr>
        </thead>
        <tbody id='tbody10'>
        </tbody>
    </table>
    
    <!--
    https://stackoverflow.com/questions/11759992/calculating-jdayjulian-day-in-javascript
    https://en.wikipedia.org/wiki/Lunar_month
    // I copied very small parts by eye and hand, then confirmed stuff elsewhere
    https://jasonsturges.medium.com/moons-lunar-phase-in-javascript-a5219acbfe6e
    -->
</body>
</html>
