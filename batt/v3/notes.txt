09:24am
    I need more term vars and handlers, in wait and central
    

07:00am
    If I don't check for the first adb log line in central, the debounce request will kill the log

06:56am

    adb logcat -c  is unstable in the adb log reader class.  It has someting to do with the fact that adb logcat -c 
	will both wait for a device but will wait forever if the adb server fluctuates.  
	logcat -c probably needs to go along with wait-for-device

2025/12/21 06:18am

My new theory is to have a "wait-for-device" that does indeed trigger everything.
    I need to see what I think is stderr of the adb server starting, if in fact it needs to start.
    Then wait-for-devices either exits silently, which is golden, or it exits with an error if the server is killed again
    I still need debouncing or something where usb and devices and wait-for all try to happen around the same time.
    It's valid to try to run the log first, but that can also go in a circle.  
    

I still need "adb devices" to check for permission.


**********
2025/12/14 00:11

adb shell
adb devices
adb logcat
lsusb
udevmonitor

popen
proc_open
shell_exec
exec
system

*******


# Android 5
D/BatteryService(  961): level:69, scale:100, status:2, health:2, present:true, voltage: 4143, temperature: 226, technology: Li-ion, AC powered:false, USB powered:true, Wireless powered:false, icon:17303724, invalid charger:0

# Android 13-ish
--------- beginning of system
12-13 00:47:03.208  1256  1529 D BatteryService: Processing new values: chargerAcOnline=false, chargerUsbOnline=true, maxChargingCurrent500000, maxChargingVoltage5000000, batteryStatus=2, batteryHealth=2, batteryPresent=true, batteryLevel=36, batteryTechnology=Li-ion, batteryVoltage=3943, batteryChargeCounter=1043280, batteryFullCharge=2898000, batteryTemperature=220, mBatteryLevelCritical=false, mPlugType=2



2025/12/12 21:30

about to delete a bunch of USB stuff


use ReactLineStream\LineStream;  // installed from Tsufeki


2025/12/12 05:08am

is lsusb still useful?

2025/12/11 07:52 - 08:23+

timeout 3 adb wait-for-device


PHP React
has a lines feature
has a signal handling feature
has a setTimeout equivalent


# clears buffer
adb logcat -c

# ??
# probably not
adb logcat -c BatteryService:D *:S

# current phone - does exactly what I want at a reasonable data rate
# Note that it seems to mix in old timestamps and then maybe stabilizes
# cat'ing a-db s-hell is much faster, but the following will start, well, following the data I want:
adb logcat BatteryService:D *:S


# Android 5
# probably too loud / too much data; haven't tried the above
adb logcat BatteryMeterView:D *:S

************
2025/12/09 08:43am

If lsusb() is true (perhaps make static?), then adb kill-server
Check for other processes before the older one blanks the output when it's killed.  Separate the functions into ID other and kill other.

Note that I am not accounting for TCP/IP adb

****************
# sudo apt install python3-pyudev

I want a default timeout as given but, if a numerical argument comes in, use that timeout.

$read is stdout
$write  = null;
$except = null;

if (stream_select($read, $write, $except, 0, 200000) > 0)



If I want to background and then exit the calling bash shell, I have to use nohup on the php script.
20:06pm 12/08


***************

2025/12/08 06:52am

It's actually dying fairly quickly when it goes into the background.  It's not immediate but ...

Wait, perhaps that's the control-Z
   Grok says no.

There are 18 echo instances.  Probably should make those into a log.


I have a *lot* of udevadm hung or running and such.  Maybe that's the problem.
    Most are from hours ago.
