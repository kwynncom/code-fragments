<!DOCTYPE html>
<html lang='en'>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<meta name='viewport' content='width=device-width, initial-scale=1.0' />

<title>timecard</title>

<style>
    body { font-family: sans-serif; }
    [data-type="dow"] { font-family: monospace; width: 4ex; font-size: 110%; }
    input:disabled, input:read-only {
        background-color: white;
        color: black;
        opacity: 1;
        border: none;
    }
</style>

<script src='/opt/kwynn/js/utils.js'></script>
<script>
    
function tickColor() { return '#66FF00'; }

class tickIndicator {
    constructor() {
        onDOMLoad(() => {
            this.e = byid('indicatore');
            this.i = 0;
        });
    }
    
    set(is) {
        this.tick();
        this.sih = setInterval(() => this.tick(), 200);
    }
    
    tick() {
        if (this.i++ % 4 <= 1) {
            this.e.style.color = tickColor();
            this.e.style.opacity = 1;
        }
        else {
            this.e.style.opacity = 0;
        }
    }
}

class trackTime {
    constructor(e) {
        this.e  = e;
        this.tick();
        setInterval(() => { this.tick(); }, 1000);
    }
    
    tick() {
        const uto = new Date();
        const lof = uto.getTimezoneOffset() * 60 * 1000;
        const lob = new Date(time() - lof);
        const los = lob.toISOString();
        const nowDate = los.substring(0, 10);
        const nowTime = los.substring(11,16);
        this.e.value = nowTime;       
    }
}

class timecardCl {

    constructor() { 
        this.tick = new tickIndicator();
    }

    onStartBtn() { kwjss.sobf('server.php', { action: 'start', from : 'button'}, (res) => { this.pop10(res); }); }
    pop10(din) {
        
        const isst = din['action'] === 'start';
        
        if (isst) { 
            qs('[data-tcursor="1"][data-type="db" ]').value = din.db;
            qs('[data-tcursor="2"][data-type="db" ]').value = din.db;
            qs('[data-tcursor="1"][data-type="hr" ]').value = din.hr;
            qs('[data-tcursor="2"][data-type="hr" ]').value = din.hr;
            qs('[data-tcursor="2"][data-type="hr" ]').style.backgroundColor = tickColor();
            new trackTime(qs('[data-tcursor="2"][data-type="hr" ]'));
            qs('[data-tcursor="1"][data-type="dow"]').innerHTML = din.dow;
            this.tick.set(true);
        }
    }
}

var tco = new timecardCl();

onDOMLoad(() => {
    new trackTime(byid('wallClock'));
});

</script>


</head>
<body>
    
    <div><input type='time' id='wallClock' readonly='readonly' disabled='disabled' required='required' /></div>
    
    <div>
        <button onclick='tco.onStartBtn();'>start</button>
        <div id='indicatore' style='color: red;'>&#11044;</div>

    </div>
    <table>
        <thead>
            <tr><th></th><th>start</th><th>stop</th></tr>
        </thead>
        <tbody>
        <tr>    
            <td                    data-tcursor='1' data-type='dow' ></td>
            <td>
                <input type='date' data-tcursor='1' data-type='db' />
                <input type='time' data-tcursor='1' data-type='hr' />
            </td>
            <td>
                <input type='date' data-tcursor='2' data-type='db' />
                <input type='time' data-tcursor='2' data-type='hr' />                
            </td>
        </tr>
        </tbody>
    </table>
       
</body>
</html>

