<!DOCTYPE html>
<html lang='en'>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'    />
<meta name='viewport' content='width=device-width, initial-scale=1.0' />

<title>web notifications test</title>

<style>
    body { font-family: sans-serif; }
</style>

<script src='/opt/kwynn/js/utils.js'></script>

<script>
	
class kwNotifyTest {
	
	constructor(doRequest) { 
		if (doRequest) this.requestPermission();	
		this.doWorkerStuff();
		this.doNotify();
	}
	
	requestPermission() {
		Notification.requestPermission().then((result) => {
		  // console.log(result);
		  this.doNotify();
		});		
	}

	doNotify() {
		if (Notification.permission !== "granted") return;
		// this.worker.showNotification('test 5', { body : 'tb5'});
		ServiceWorkerRegistration.showNotification('t6');
	}
	
	doWorkerStuff() {
		if ("serviceWorker" in navigator) {
		  navigator.serviceWorker
			.register("worker.js")
			.then((registration) => {
			  registration.addEventListener("updatefound", () => {
				// If updatefound is fired, it means that there's
				// a new service worker being installed.
				const installingWorker = registration.installing;
				console.log(
				  "A new service worker is being installed:",
				  installingWorker
				);

				// You can listen for changes to the installing service worker's
				// state via installingWorker.onstatechange
			  });
			})
			.catch((error) => {
			  console.error(`Service worker registration failed: ${error}`);
			});
		} else {
		  console.error("Service workers are not supported.");
		}

	}
}

onDOMLoad(() => { 
	const o = new kwNotifyTest(true);
	o.doNotify(); 
});
</script>

</head>
<body>
	<div>
		<button onclick='new kwNotifyTest(true);'>grant notification permission</button>
	</div>
	<div>v5
		
	</div>
</body>
</html>
