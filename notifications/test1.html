<!DOCTYPE html>
<html lang='en'>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'    />
<meta name='viewport' content='width=device-width, initial-scale=1.0' />

<title>web notifications test</title>

<style>
    body { font-family: sans-serif; }
</style>

<script src='/opt/kwynn/js/utils.js'></script>

<script>
	
class kwNotifyTest {
	
	constructor(doRequest) { 
		if (doRequest) this.requestPermission();	
		this.doNotify();
	}
	
	requestPermission() {
		this.doWorkerStuff();
		Notification.requestPermission().then((result) => {
		  // console.log(result);
		  this.doNotify();
		});		
	}

	async doNotify() {
		if (Notification.permission !== 'granted') return;
		// this.worker.showNotification('test 5', { body : 'tb5'});
		if (!this.worker) {
			await this.wpr;
			this.worker.showNotification('t6');
		}
	}
	
	doWorkerStuff() {
		
		this.wpr =   navigator.serviceWorker.register('worker.js').then((w) => { this.worker = w; });
			
		

	}
}

onDOMLoad(() => { 
	const o = new kwNotifyTest(true);
	o.doNotify(); 
});
</script>

</head>
<body>
	<div>
		<button onclick='new kwNotifyTest(true);'>grant notification permission</button>
	</div>
	<div>v6
		
	</div>
</body>
</html>
