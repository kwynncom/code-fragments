<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>JavaScript ping 3</title>

<style>
	body { font-family: monospace; }
	td   { text-align: right; }
</style>
<script src='utils.js' ></script>
<script src='ping10.js'></script>
<script>

	class runningDC {
		
		constructor() {
			const self = this;
			this.bar = [];
			setInterval(function() { self.disp(); }, 170);
		}
		
		reg(d, ce, de) {
			this.disp1e(d, de);
			const o = { 'asof' : time() + d, 'd' : d, 'e' : ce, 'active' : true};
			this.bar.push(o);
		}
		
		disp1e(d, ele) {
			let s = '--';
			if (!Number.isNaN(d)) s = d; 
			ele.innerHTML = s;
		}
		
		disp() {
			for (let i=this.bar.length - 1; i >= 0; i--) {
				const r = this.bar[i];
				if (!r) continue;
				if (!r.active) continue;
				this.disp20(i); 
			}
		}
		
		diff(i) { 	
			const d = time() - this.bar[i].asof;
			const isnum = !Number.isNaN(d);
			if (isnum) return d;
			else return false;
		}
		
		disp20(i) {
			const d = this.diff(i);
			let s = '--';
			if (d !== false) { 
				const p = 2;

				const n1 = roundTo(d/ 1000, p);
				s    = n1.toFixed(p);
			} else this.bar[i].active = false;
			
			this.bar[i].e.innerHTML = s;
		}		
	}

	var KW_G_rdco = new runningDC();
	
	class draw1Ping {
		constructor(tbid) {
			this.tb = byid(tbid);
			this.do10();
		}
		
		do10() {
			const tr = cree('tr');
			this.tb.prepend(tr);
			const tdst = cree('td');
			const pos = [];
			let i = 0;
			const self = this;
			for (i=0; i < 4; i++) {
				const td = cree('td');
				tr.append(td);
				pos[i] = new do1ping(function(d) {
										KW_G_rdco.reg   (d, tdst, td);
										self.iter1();
									 }
				);
			}
			tr.append(tdst);
			this.pos = pos;
			this.iterInit();

		}
		
		iterInit() {
			this.iteri = 0;
			this.pos[this.iteri].ping();			
		}
		
		iter1() {
			if (this.pos[++this.iteri]) this.pos[this.iteri].ping();
		}
		
		
	}


	
</script>


</head>
<body>
	<div>
		<button onclick='new draw1Ping("tb10");	'>ping</button>
	</div>
	<div>
		<table>
			<tbody id='tb10'>
			</tbody>
		</table>
	</div>
	<script>
	window.onload = function() {
		new draw1Ping('tb10');	
	}
	</script>
		
</body>
</html>
